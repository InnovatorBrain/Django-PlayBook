## Build API
### Designing Phase
This means How it works Operations, get, add, update, remove, etc
Operations like 
POST, GET, DELETE, PATCH, DELETE ...
### Check the Data Model 
@models.py
A Hacker can access Django self-contained IDs because of sequence numbers. Solution is bellow
#### GUID: Globally Unique Identifier
    from uuid import uuid4
    class Cart(models.Model):
    id = models.UUIDField(primary_key=True, default=uuid4)
For no duplicate in the same cart the same product

        class Meta:
        unique_together = [['cart', 'product']]
## A Guide on How to Build an API, Step by Step.
- Model
- Serializer
- View
- Route

-MODEL:

    class Cart(models.Model):
        id = models.UUIDField(primary_key=True, default=uuid4)
        created_at = models.DateTimeField(auto_now_add=True)

    class CartItem(models.Model):
        cart = models.ForeignKey(Cart, on_delete=models.CASCADE, related_name="items") #cartitem_set 
        product = models.ForeignKey(Product, on_delete=models.CASCADE)
        quantity = models.PositiveSmallIntegerField()
-SERIALIZER:

   
    class SimpleProductSerializer(serializers.ModelSerializer):
    class Meta:
        model = Product
        fields = ["id", "title", "unit_price"]


    class CartItemSerializer(serializers.ModelSerializer):
        product = SimpleProductSerializer(read_only=True)
        total_price = serializers.SerializerMethodField()

    def get_total_price(self, cart_item: CartItem):
        return cart_item.quantity * cart_item.product.unit_price

    class Meta:
        model = CartItem
        fields = ["id", "product", "quantity", "total_price"]


    class CartSerializer(serializers.ModelSerializer):
        id = serializers.UUIDField(read_only=True)
        items = CartItemSerializer(many=True)
        total_price = serializers.SerializerMethodField()

    def get_total_price(self, cart):
        return sum(
            item.quantity * item.product.unit_price for item in cart.items.all()
        )

    class Meta:
        model = Cart
        fields = ["id", "created_at", "items", 'total_price']

    def create(self, validated_data):
        items_data = validated_data.pop("items", [])
        cart = Cart.objects.create(**validated_data)

        for item_data in items_data:
            CartItem.objects.create(cart=cart, **item_data)

        return cart


- VIEW: | Let's create a customized view to exclude the list and update options for carts that we don't need.

        class CartViewSet(CreateModelMixin, RetrieveModelMixin, GenericViewSet):
            queryset = Cart.objects.prefetch_related('items__product').all()
            serializer_class = CartSerializer
- URLs:

      router.register("carts", views.CartViewSet)
      urlpatterns = [
      path("", include(router.urls)),
      # Add a URL pattern for the collection detail view
      path("collections/<int:pk>/",views.CollectionViewSet.as_view({"get": "retrieve"}),name="collection-detail"),
      path('carts/<uuid:cart_id>/',views.CartViewSet.as_view({"get": "retrieve"})),
      path("products/<int:pk>/reviews/",views.ReviewViewSet.as_view({"post": "create"})),
      ]

         
